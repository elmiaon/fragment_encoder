# fragment_encoder
ใน README นี้ประกอบด้วย

- การสร้างและรัน docker
- การโหลดและเตรียมข้อมูล
- การรันโปรแกรม

## การสร้างและรัน docker

หลังจาก clone เสร็จให้ใช้คำสั่งด้านล่างเพื่อสร้าง docker

    sh init.sh

จากนั้นใช้คำสั่งด้านล่างเพื่อเข้าสู่ docker ที่สร้างไว้

    docker exec -ti fragment_encoder /bin/bash
    
ใช้คำสั่งด้านล่างเพื่อไปยัง mount

    cd /mount
    
## การโหลดและเตรียมข้อมูล
    
จากนั้นใช้คำสั่งด้านล่างเพื่อโหลด dataset ขั้นตอนนี้อาจไว้เวลานานหลายนาทีจนถึงชั่วโมง

    bash load_opus.sh
    
ถึงจุดนี้จะได้ไฟล์ในโฟลเดอร์ data ตามนี้

- data/
    - raw/
        - opus/
            - JW300/
            - QED/
            - TED2020/

ใน JW300, QED, และ TED2020 จะมีไฟล์

- ar-en.ar
- ar-en.en
- de-en.de
- de-en.en
- fr-en.en
- fr-en.fr
- th-en.en
- th-en.th

จากนั้นรันคำสั่งด้านล่างเพื่อเตรียมข้อมูลให้พร้อมรัน

    python3 create.opus.py

## การรันโปรแกรม
ให้รันไฟล์ทดสอบตามคำสั่งด้านล่าง

    python3 RFRv2.JW300s0main.test.py
    
ถ้าโปรแกรมรันถูกต้องจะได้ไฟล์ด้านล่าง

    data/tested/RFRt.RFRr0.cosine50.RFRa0/test_opus-JW300-CLSRs0_te-c50.tune_opus-JW300-CLSRs0_tu-c50.fr-en.csv

ซึ่งเป็นตาราง csv ที่มีผลดังนี้

| k | beta | fil              | p_thres           |n  |acc   | fil_p             | fil_r| fil_f1            |align_p            | align_r| align_f1          |
|---|------|------------------|-------------------|---|------|-------------------|------|-------------------|-------------------|--------|-------------------|
|45 |90    |0.6000000000000001| 0.7999999999999999| 1 | 0.817| 0.9968652037617555| 0.636| 0.7765567765567766| 0.9968652037617555| 0.636  | 0.7765567765567766|
|45 |90    |0.6000000000000001| 0.7999999999999999| 5 | 0.817| 0.9968652037617555| 0.636| 0.7765567765567766| 0.9968652037617555| 0.636  | 0.7765567765567766|
|45 |90    |0.6000000000000001| 0.7999999999999999| 10| 0.817| 0.9968652037617555| 0.636| 0.7765567765567766| 0.9968652037617555| 0.636  | 0.7765567765567766|

นอกจากนั้นผลการจับคู่จะแสดงอยู่ในไฟล์ csv ที่อยู่ใน directory ด้านล่าง

    data/ans/RFRt.RFRr0.cosine50.RFRa0/test_opus-JW300-CLSRs0_te-c50.tune_opus-JW300-CLSRs0_tu-c50.fr-en.csv
    
โดยมี format ดังนี้

- id: sentence id ของประโยคใน source language
- candidates: tuples ของ candidate sentences เรียงตาม prob จากมากไปน้อย
- prob: byte string ของความน่าจะเป็นของแต่ละ candidate sentence
- ans: boolene ที่จะบอกว่า top 1 candidate มีค่าสูงกว่า p_thres หรือไม่
    - True หมายความว่า top1 เป็นคู่ของ query sentence
    - False หมายความว่า ไม่มีคำตอบ
